<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLASHUP | Competitive PvP</title>
    
    <!-- FONTS & ICONS -->
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <!-- CHART.JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    
    <div id="toast-box"></div>

    <nav>
        <div class="container nav-inner">
            <div class="logo-container" onclick="switchTab('home')">
                <div class="logo">SLASH<span>UP</span></div>
                <div class="server-status" id="server-status-text">
                    <span class="status-dot offline" id="status-dot"></span> OFFLINE
                </div>
            </div>

            <div class="nav-links">
                <button class="nav-btn active" onclick="switchTab('home')" id="btn-home">HOME</button>
                <button class="nav-btn" onclick="switchTab('leaderboard')" id="btn-leaderboard">LEADERBOARD</button>
                <button class="nav-btn" onclick="switchTab('stats')" id="btn-stats">STATS</button>
                <button class="nav-btn" onclick="copyIP()" style="color: #44ff44;">COPY IP</button>
            </div>
        </div>
    </nav>

    <!-- === HOME PAGE === -->
    <div id="home-page" class="page-section active">
        <div class="container">
            <section class="hero">
                <div>
                    <h1>High Fidelity<br>Combat</h1>
                    <p>Experience the next generation of Minecraft PvP. <br>Directional blocking, parrying, and ranked matchmaking.</p>
                    <button class="cta-btn" onclick="copyIP()">PLAY.SLASHUP.NET</button>
                </div>
            </section>

            <!-- LIVE FEED -->
            <div class="container reveal" style="margin-bottom: 4rem;">
                <div style="display:flex; align-items:center; gap:10px; margin-bottom: 1rem;">
                    <div style="width:10px; height:10px; background:var(--accent); border-radius:50%; box-shadow:0 0 10px var(--accent); animation: pulse 2s infinite;"></div>
                    <div class="section-title" style="margin:0; border:none; font-size: 1.2rem;">LIVE BATTLES</div>
                </div>
                <div id="global-feed">
                    <div style="color:#666; font-family:'Share Tech Mono'">Loading live battles...</div>
                </div>
            </div>
            
            <!-- NEWS & MECHANICS :O -->
            <div class="content-row reveal">
                <div class="panel-box">
                    <div class="section-title">Latest Updates</div>
                    <div class="news-item">
                        <div class="news-date">DEC 1, 2025</div>
                        <div class="news-head">Multi-Directional Dash & Bug Fixes | v0.2</div>
                        <p style="color: #888; font-size: 0.9rem;">Dashing now supports W+D diagonals for better evasion. Killer health is now displayed in death messages.</p>
                    </div>
                    <div class="news-item">
                        <div class="news-date">NOV 29, 2025</div>
                        <div class="news-head">Contracts, Balancing & Duels | v0.1</div>
                        <p style="color: #888; font-size: 0.9rem;">Added 1v1 Duels with Elo logic. Daily Contracts system is live.</p>
                    </div>
                </div>

                <div class="mech-grid">
                    <div class="tilt-card">
                        <i class="fas fa-shield-alt" style="font-size:1.5rem; color:var(--accent); margin-bottom:10px;"></i>
                        <h3>Parry</h3><p style="color:#666; font-size:0.8rem;">Press F within 0.3s to stun.</p>
                    </div>
                    <div class="tilt-card">
                        <i class="fas fa-wind" style="font-size:1.5rem; color:var(--accent); margin-bottom:10px;"></i>
                        <h3>Dash</h3><p style="color:#666; font-size:0.8rem;">Q + WASD to evade.</p>
                    </div>
                    <div class="tilt-card">
                        <i class="fas fa-bolt" style="font-size:1.5rem; color:var(--accent); margin-bottom:10px;"></i>
                        <h3>Clash</h3><p style="color:#666; font-size:0.8rem;">Sparks fly on impact.</p>
                    </div>
                </div>
            </div>

            <!-- TEAM (me, flex ikr) & DISCORD -->
            <div class="team-section reveal">
                <h2 class="team-header">Meet Our Team</h2>
                <div class="team-grid">
                    <div class="team-card">
                        <img src="https://visage.surgeplay.com/bust/256/HugeAdventure" class="team-skin">
                        <div class="team-name">HugeAdventure</div>
                        <div class="team-role">Founder & Lead Developer</div>
                        <div class="social-links">
                            <i class="fab fa-github social-icon"></i>
                            <i class="fab fa-discord social-icon"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="discord-banner reveal">
                <div class="discord-text">
                    <h3>Join the <span>Community</span></h3>
                    <p>Connect with tons of players, find scrim partners, and get update alerts.</p>
                </div>
                <button class="discord-btn" onclick="window.open('https://discord.gg/vSrF97MfpW', '_blank')">
                    <i class="fab fa-discord"></i> Join Server
                </button>
            </div>
        </div>
    </div>

    <!-- LEADERBOARD  -->
    <div id="leaderboard-page" class="page-section">
        <div class="container">
            <h1 style="text-align:center; margin: 3rem 0 1.5rem 0;">GLOBAL RANKINGS</h1>
            
            <div class="lb-filter-bar">
                <button class="filter-btn active" onclick="switchLbCategory('wins')" id="sort-wins">
                    <i class="fas fa-trophy"></i> Wins
                </button>
                <button class="filter-btn" onclick="switchLbCategory('kdr')" id="sort-kdr">
                    <i class="fas fa-crosshairs"></i> K/D Ratio
                </button>
                <button class="filter-btn" onclick="switchLbCategory('kills')" id="sort-kills">
                    <i class="fas fa-skull"></i> Kills
                </button>
                <button class="filter-btn" onclick="switchLbCategory('streak')" id="sort-streak">
                    <i class="fas fa-fire"></i> Streak
                </button>
            </div>
    
            <div class="lb-controls">
                <button class="nav-btn" id="lb-prev" onclick="changeLbPage(-1)"><i class="fas fa-chevron-left"></i> PREV</button>
                <span id="lb-page-num" style="font-family:'Share Tech Mono'; color:#666;">PAGE 1</span>
                <button class="nav-btn" id="lb-next" onclick="changeLbPage(1)">NEXT <i class="fas fa-chevron-right"></i></button>
            </div>
    
            <table class="lb-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th id="th-wins">Wins</th>
                        <th id="th-kills">Kills</th> 
                        <th id="th-kdr">K/D</th>
                        <th id="th-streak">Streak</th>
                    </tr>
                </thead>
                <tbody id="lb-body"></tbody>
            </table>
        </div>
    </div>

    <!-- STATS -->
    <div id="stats-page" class="page-section">
        <div class="container stats-hero">
            <h1 style="margin: 3rem 0;">PLAYER DATABASE</h1>
            
            <div class="search-wrapper">
                <div class="search-container">
                    <input type="text" id="playerInput" class="search-input" placeholder="Search Username..." autocomplete="off">
                    <div id="suggestions-box"></div>
                </div>
                <button class="cta-btn" onclick="fetchStats()" style="padding:0 2rem; margin:0;"><i class="fas fa-search"></i></button>
            </div>
            
            <div id="recent-container">
                <div style="font-size: 0.7rem; color: #666; margin-bottom: 8px; font-family: 'Share Tech Mono'; text-transform:uppercase;">
                    <i class="fas fa-history"></i> Recent Searches
                </div>
                <div id="recent-list"></div>
            </div>

            <!-- PROFILE GRID -->
            <div class="profile-container" id="profileDisplay">
                
                <!-- LEFT COLUMN -->
                <div class="profile-left">
                    <div class="skin-viewer skeleton" id="skinContainer">
                        <img src="" id="skinImg" class="skin-img" alt="Player Skin">
                    </div>

                    <div class="panel-box bio-box skeleton" id="bioBox">
                        <div class="section-title" style="width:100%; border:none; margin-bottom:0;">COMBAT BIOMETRICS</div>
                        <div style="width: 100%; height: 280px; position: relative;">
                            <canvas id="radarChart"></canvas>
                        </div>
                        <div id="playerClass" style="position:absolute; bottom:10px; right:10px; font-family:'Share Tech Mono'; color:var(--accent); font-size:1.5rem; opacity:0.8;">
                            CLASS: <span style="color:white;">UNKNOWN</span>
                        </div>
                    </div>

                    <div class="panel-box nemesis-box skeleton" id="nemesisBox">
                        <div class="section-title" style="color:var(--loss); border-color:rgba(255, 62, 62, 0.3);">
                            <i class="fas fa-skull-crossbones"></i> ARCH NEMESIS
                        </div>
                        <div style="padding-top:1rem;">
                            <img src="" id="nemesisHead" style="width:64px; height:64px; border-radius:8px; border:2px solid var(--loss); box-shadow: 0 0 15px rgba(255, 62, 62, 0.3);">
                            <h2 id="nemesisName" style="margin-top:10px; font-size:1.5rem;">-</h2>
                            <p style="color:#888; font-family:'Share Tech Mono'; font-size:0.9rem;">
                                Killed you <span id="nemesisKills" style="color:white; font-weight:bold;">0</span> times
                            </p>
                        </div>
                    </div>
                </div>
        
                <!-- RIGHT COLUMN -->
                <div class="player-data">
                    <div style="margin-bottom:1rem; display:flex; justify-content:space-between; align-items:flex-end;">
                        <div>
                            <div style="display:flex; align-items:center; gap: 15px;">
                                <h2 class="skeleton" style="display:inline-block; margin:0; min-width: 150px;" id="nameDisplay">Player</h2>
                                <span id="tagDisplay"></span> 
                                <button class="share-btn" onclick="shareProfile()"><i class="fas fa-share-alt"></i></button>
                            </div>
                            <div style="margin-top: 10px; display: flex; align-items: center; gap: 15px;">
                                <span class="rank-badge skeleton" id="rankDisplay" style="min-width: 50px;"># -</span>
                                <div id="viewContainer" class="skeleton" style="color: var(--text-dim); min-width: 60px;">
                                    <i class="far fa-eye" style="margin-right: 5px;"></i>
                                    <span id="viewCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <div class="stats-big-grid">
                        <div class="big-stat accent">
                            <div style="font-size:0.8rem; color:#888;">K/D RATIO</div>
                            <div class="big-stat-val skeleton" id="kdrVal">-</div>
                        </div>
                        <div class="big-stat">
                            <div style="font-size:0.8rem; color:#888;">TOTAL WINS</div>
                            <div class="big-stat-val skeleton" id="winsVal">-</div>
                        </div>
                        <div class="big-stat">
                            <div style="font-size:0.8rem; color:#888;">BEST STREAK</div>
                            <div class="big-stat-val skeleton" id="streakVal">-</div>
                        </div>
                    </div>

                    <div class="chart-container skeleton" id="chartBox">
                        <div class="section-title" style="font-size:1rem; border:none; margin-bottom:5px;">Performance History</div>
                        <div id="sequenceTicker" class="sequence-box"></div>
                        <canvas id="performanceChart"></canvas>
                    </div>
            
                    <div class="win-rate-container skeleton" id="wrBox">
                        <div class="wr-label">
                            <span>WIN RATE</span><span id="wr-percent">50%</span>
                        </div>
                        <div class="wr-bar">
                            <div id="bar-win" class="wr-win" style="width: 50%"></div>
                            <div id="bar-loss" class="wr-loss" style="width: 50%"></div>
                        </div>
                    </div>
            
                    <div class="panel-box">
                        <div class="section-title" style="font-size:1rem;">Recent Matches</div>
                        <div id="matchHistoryList" class="match-list">
                            <div class="match-card skeleton" style="height: 60px;"></div>
                            <div class="match-card skeleton" style="height: 60px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container" style="display:flex; justify-content:space-between; align-items:center;">
            <div style="text-align:left;">
                <div style="font-weight:bold; font-size:1.2rem; color:white; margin-bottom:5px;">SLASH<span style="color:var(--accent)">UP</span></div>
                <div style="color:#666;">&copy; 2025 SlashUp. <br>Not affiliated with Mojang AB.</div>
            </div>
            <div style="display:flex; gap:20px;">
                <a href="#" style="color:#888; text-decoration:none;">Store</a>
                <a href="#" style="color:#888; text-decoration:none;">Rules</a>
                <a href="#" style="color:#888; text-decoration:none;">Appeal</a>
            </div>
        </div>
    </footer>

    <script>
        // variables
        const SPECIAL_TAGS = {
            "hugeadventure": { text: "OWNER", class: "tag-owner" },
            "admin_name":    { text: "ADMIN", class: "tag-admin" },
            "dev_name":      { text: "DEV",   class: "tag-dev" }
        };

        let myChart = null;
        let myRadar = null;
        
        let currentLbPage = 1;
        let totalLbPages = 1;
        let currentLbSort = 'wins'; 

        //  before load thing i forgot what its called, maybe initialization. yes.
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const playerParam = urlParams.get('player');
            if(playerParam) {
                document.getElementById('playerInput').value = playerParam;
                switchTab('stats');
                fetchStats();
            }
            
            setupAutocomplete();
            initParticles();
            animateParticles();
            loadGlobalFeed();
            updateRecent();
            checkServerStatus();
            
            // Load Leaderboard Page 1
            loadLeaderboard(1);
            
            // Loops
            setInterval(loadGlobalFeed, 30000);
        }

        //  NAVIGATION
        function switchTab(tab) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tab + '-page').classList.add('active');
            document.getElementById('btn-' + tab).classList.add('active');
            const footer = document.querySelector('footer');
            footer.style.display = (tab === 'stats') ? 'none' : 'block';
        }

        // GET STATS
        async function fetchStats() {
            const username = document.getElementById('playerInput').value;
            if(!username) return;

            const container = document.getElementById('profileDisplay');
            container.classList.add('visible'); 
            
            const idsToLoad = ['nameDisplay', 'rankDisplay', 'viewContainer', 'kdrVal', 
                   'winsVal', 'streakVal', 'skinContainer', 'chartBox', 'wrBox', 'bioBox', 'nemesisBox'];
                               
            idsToLoad.forEach(id => {
                const el = document.getElementById(id);
                if(el) el.classList.add('skeleton');
            });
            
            const skinImg = document.getElementById('skinImg');
            skinImg.classList.remove('loaded'); skinImg.src = ''; 
            document.getElementById('nemesisHead').src = '';
            document.getElementById('matchHistoryList').innerHTML = `<div class="match-card skeleton" style="height: 60px;"></div><div class="match-card skeleton" style="height: 60px;"></div>`;
            document.getElementById('sequenceTicker').innerHTML = '';

            try {
                const response = await fetch(`/api?player=${username}`);
                const data = await response.json();
        
                if(data.error) { 
                    alert("Player not found!"); 
                    cleanSkeletons(idsToLoad);
                    return; 
                }
        
                saveToHistory(username);
                
                const stats = data.stats || {};
                const matches = data.matches || [];

                document.getElementById('nameDisplay').innerText = stats.name || username;
                document.getElementById('kdrVal').innerText = parseFloat(stats.kdr || 0).toFixed(2);
                document.getElementById('winsVal').innerText = stats.wins || 0;
                document.getElementById('streakVal').innerText = stats.best_streak || 0;
                document.getElementById('viewCount').innerText = stats.views || 0;
                
                const rankEl = document.getElementById('rankDisplay');
                rankEl.innerText = `#${stats.rank || '-'}`;
                rankEl.style.background = 'var(--panel)'; rankEl.style.color = 'var(--text-dim)';
                if(stats.rank === 1) { rankEl.style.background = 'var(--gold)'; rankEl.style.color = 'black'; }
                else if(stats.rank === 2) { rankEl.style.background = 'var(--silver)'; rankEl.style.color = 'black'; }
                else if(stats.rank === 3) { rankEl.style.background = 'var(--bronze)'; rankEl.style.color = 'black'; }

                const totalGames = (stats.wins || 0) + (stats.losses || 0);
                let winPercent = totalGames > 0 ? Math.round((stats.wins / totalGames) * 100) : 50;
                document.getElementById('wr-percent').innerText = `${winPercent}%`;
                document.getElementById('bar-win').style.width = `${winPercent}%`;
                document.getElementById('bar-loss').style.width = `${100 - winPercent}%`;
        
                try { renderChart(matches, username); } catch(e) { console.error("Chart", e); }
                try { renderBiometrics(stats); } catch(e) { console.error("Bio", e); }
                try { findNemesis(matches, username); } catch(e) { console.error("Nemesis", e); }
                try { renderTicker(matches, username); } catch(e) { console.error("Ticker", e); }
                
                const historyContainer = document.getElementById('matchHistoryList');
                historyContainer.innerHTML = ''; 
                
                if(matches.length === 0) {
                    historyContainer.innerHTML = '<div style="color:#666; text-align:center; padding:1rem;">No matches played yet.</div>';
                } else {
                    matches.forEach(match => {
                        const isWin = match.winner_name.toLowerCase() === username.toLowerCase();
                        const opponent = isWin ? match.loser_name : match.winner_name;
                        const dateStr = new Date(match.match_time).toLocaleDateString();
                        const cardClass = isWin ? 'win' : 'loss';
                        const outcomeText = isWin ? 'VICTORY' : 'DEFEAT';
                        const icon = isWin ? '<i class="fas fa-trophy"></i>' : '<i class="fas fa-skull"></i>';
                        
                        historyContainer.innerHTML += `
                            <div class="match-card ${cardClass}">
                                <div class="match-outcome">${icon} <span>${outcomeText}</span></div>
                                <div class="match-vs">
                                    <span style="color:#666; font-size:0.8rem;">VS</span>
                                    <img src="https://visage.surgeplay.com/face/64/${opponent}" class="opponent-head">
                                    <span class="opponent-name">${opponent}</span>
                                </div>
                                <div class="match-date">${dateStr}</div>
                            </div>`;
                    });
                }
        
                const skinContainer = document.getElementById('skinContainer');
                skinImg.onload = () => { skinImg.classList.add('loaded'); if(skinContainer) skinContainer.classList.remove('skeleton'); };
                skinImg.onerror = () => { if(skinContainer) skinContainer.classList.remove('skeleton'); };
                skinImg.src = `https://visage.surgeplay.com/full/512/${username}`;

                const tagEl = document.getElementById('tagDisplay');
                tagEl.innerHTML = ""; 
                const lowerName = username.toLowerCase();
                if(SPECIAL_TAGS[lowerName]) {
                    const tagData = SPECIAL_TAGS[lowerName];
                    tagEl.innerHTML = `<span class="player-tag ${tagData.class}">${tagData.text}</span>`;
                }

                cleanSkeletons(idsToLoad);
        
            } catch (error) { 
                console.error(error); 
                cleanSkeletons(idsToLoad);
                alert("Error: " + error.message);
            }
        }

        function cleanSkeletons(ids) {
            ids.forEach(id => {
                if(id !== 'skinContainer') { 
                    const el = document.getElementById(id);
                    if(el) el.classList.remove('skeleton');
                }
            });
        }

        // LEADERBOARD
        function switchLbCategory(category) {
            if(currentLbSort === category) return; 
            currentLbSort = category; currentLbPage = 1; 
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`sort-${category}`).classList.add('active');
            loadLeaderboard(1);
        }
        
        async function loadLeaderboard(page) {
            currentLbPage = page;
            document.getElementById('lb-page-num').innerText = `PAGE ${page}`;
            const nextBtn = document.getElementById('lb-next');
            const prevBtn = document.getElementById('lb-prev');
            if(page === 1) prevBtn.classList.add('disabled'); else prevBtn.classList.remove('disabled');
        
            const tbody = document.getElementById('lb-body');
            tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:#888; padding:2rem;">Accessing Database...</td></tr>';
        
            try {
                const res = await fetch(`/api/leaderboard?page=${page}&sort=${currentLbSort}`);
                const data = await res.json();
                tbody.innerHTML = '';
                totalLbPages = data.totalPages || 1;
                if(page >= totalLbPages) nextBtn.classList.add('disabled'); else nextBtn.classList.remove('disabled');
        
                if(!data.players || data.players.length === 0) {
                     tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; color:#666;">No players found.</td></tr>`;
                     return;
                }
        
                let rankCounter = (page - 1) * 20 + 1;
                data.players.forEach(p => {
                    let rankClass = '';
                    if(rankCounter === 1) rankClass = 'rank-1';
                    else if(rankCounter === 2) rankClass = 'rank-2';
                    else if(rankCounter === 3) rankClass = 'rank-3';
                    
                    let extraTag = ''
                    let specialTag = '';
                    if(p.name && SPECIAL_TAGS[p.name.toLowerCase()]) {
                        const t = SPECIAL_TAGS[p.name.toLowerCase()];
                        specialTag = `<span class="player-tag ${t.class}" style="font-size:0.5rem; margin-left:5px;">${t.text}</span>`;
                    }
        
                    const hlWins = currentLbSort === 'wins' ? 'col-highlight' : '';
                    const hlKills = currentLbSort === 'kills' ? 'col-highlight' : '';
                    const hlKdr = currentLbSort === 'kdr' ? 'col-highlight' : '';
                    const hlStreak = (currentLbSort === 'streak' || currentLbSort === 'best_streak') ? 'col-highlight' : '';
        
                    const kdrVal = parseFloat(p.kdr || 0).toFixed(2);
                    const delay = (rankCounter % 20) * 0.05; 
                    
                    const row = `<tr class="lb-row ${rankClass}" style="opacity: 0; animation: lbSlideIn 0.3s ease-out forwards; animation-delay: ${delay}s;"><td class="rank-num">${rankCounter}</td><td><div class="player-cell"><img src="https://visage.surgeplay.com/face/64/${p.name}" class="lb-head"><div><span style="font-weight:bold; font-size:1.1rem;">${p.name}</span>${specialTag}${extraTag}</div></div></td><td class="${hlWins}" style="font-family:'Share Tech Mono'">${p.wins}</td><td class="${hlKills}" style="font-family:'Share Tech Mono'">${p.kills||0}</td><td class="${hlKdr}" style="font-family:'Share Tech Mono'">${kdrVal}</td><td class="${hlStreak}" style="color:var(--gold); font-family:'Share Tech Mono'">${p.best_streak||0}</td></tr>`;
                    tbody.innerHTML += row;
                    rankCounter++;
                });
            } catch (e) {
                console.error(e);
                tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; color:var(--loss);">Connection Failed: ${e.message}</td></tr>`;
            }
        }
        function changeLbPage(dir) {
            const newPage = currentLbPage + dir;
            if (newPage < 1) return;
            if (newPage > totalLbPages) return;
            loadLeaderboard(newPage);
        }

        // Cool visuals & chart
        function renderTicker(matches, username) {
            const ticker = document.getElementById('sequenceTicker');
            ticker.innerHTML = '';
            if(!matches) return;
            [...matches].reverse().forEach(m => {
                const isWin = m.winner_name.toLowerCase() === username.toLowerCase();
                const tick = document.createElement('div');
                tick.className = isWin ? 'seq-tick win' : 'seq-tick loss';
                tick.title = isWin ? `Win vs ${m.loser_name}` : `Loss vs ${m.winner_name}`;
                ticker.appendChild(tick);
            });
        }

        function renderChart(matches, username) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            if(!matches || matches.length === 0) { if(myChart) myChart.destroy(); return; }
            const sortedMatches = [...matches].reverse(); 
            let currentScore = 0;
            const dataPoints = sortedMatches.map(m => {
                currentScore += (m.winner_name.toLowerCase() === username.toLowerCase()) ? 1 : -1;
                return currentScore;
            });
            const labels = sortedMatches.map((_, i) => `M${i + 1}`);
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Trend', data: dataPoints, borderColor: '#ff3e3e', backgroundColor: 'rgba(255, 62, 62, 0.1)',
                        borderWidth: 2, fill: true, tension: 0.3, pointRadius: 4, pointBackgroundColor: '#0b0b10', pointBorderColor: '#ff3e3e'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { color: 'rgba(255,255,255,0.05)' } } } }
            });
        }

        function renderBiometrics(stats) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            const totalGames = (stats.wins || 0) + (stats.losses || 0);
            const survivability = Math.min(100, ((stats.wins || 0) / (totalGames || 1)) * 100 * 1.5);
            const lethality = Math.min(100, (parseFloat(stats.kdr || 0) / 4) * 100);
            const consistency = Math.min(100, ((stats.best_streak || 0) / 20) * 100);
            const experience = Math.min(100, ((stats.wins || 0) / 100) * 100);
            const aggression = Math.min(100, (lethality * 1.2) - (survivability * 0.2));
            const dataValues = [survivability, lethality, consistency, experience, aggression];
            
            const maxIndex = dataValues.indexOf(Math.max(...dataValues));
            const classes = ["GUARDIAN", "ASSASSIN", "MACHINE", "VETERAN", "BERSERKER"];
            const classEl = document.querySelector('#playerClass span');
            if(classEl) classEl.innerText = classes[maxIndex];
        
            if (myRadar) myRadar.destroy();
            myRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['SURV', 'LETHAL', 'CONST', 'EXP', 'AGGRO'],
                    datasets: [{ data: dataValues, backgroundColor: 'rgba(255, 62, 62, 0.2)', borderColor: '#ff3e3e', borderWidth: 2, pointRadius: 0 }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { r: { angleLines: { color: '#333' }, grid: { color: '#222' }, pointLabels: { color: '#888', font: { size: 10 } }, ticks: { display: false }, suggestedMin: 0, suggestedMax: 100 } },
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function findNemesis(matches, username) {
            const killers = {};
            let maxKills = 0;
            let nemesis = "None";
            matches.forEach(m => {
                if (m.winner_name.toLowerCase() !== username.toLowerCase()) {
                    killers[m.winner_name] = (killers[m.winner_name] || 0) + 1;
                    if (killers[m.winner_name] > maxKills) { maxKills = killers[m.winner_name]; nemesis = m.winner_name; }
                }
            });
            document.getElementById('nemesisName').innerText = nemesis === "None" ? "UNDEFEATED" : nemesis;
            document.getElementById('nemesisKills').innerText = maxKills;
            const headUrl = nemesis === "None" ? "Steve" : nemesis;
            document.getElementById('nemesisHead').src = `https://visage.surgeplay.com/face/128/${headUrl}`;
        }

        // UTILITOS
        document.getElementById('playerInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') fetchStats();
        });

        function setupAutocomplete() {
            const input = document.getElementById('playerInput');
            const box = document.getElementById('suggestions-box');
            let debounceTimer;
            input.addEventListener('input', function() {
                const val = this.value;
                clearTimeout(debounceTimer);
                if (val.length < 2) { box.style.display = 'none'; return; }
                debounceTimer = setTimeout(async () => {
                    try {
                        const res = await fetch(`/api/search?q=${val}`);
                        const names = await res.json();
                        box.innerHTML = '';
                        if (names.length > 0) {
                            box.style.display = 'block';
                            names.forEach(n => {
                                const div = document.createElement('div');
                                div.className = 'suggestion-item';
                                div.innerHTML = `<img src="https://visage.surgeplay.com/face/32/${n.name}" class="sug-head"><span>${n.name}</span>`;
                                div.onclick = () => { input.value = n.name; box.style.display = 'none'; fetchStats(); };
                                box.appendChild(div);
                            });
                        } else { box.style.display = 'none'; }
                    } catch (e) { console.error(e); }
                }, 300);
            });
            document.addEventListener('click', function(e) { if (e.target !== input && e.target !== box) box.style.display = 'none'; });
        }

        function updateRecent() {
            let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
            const container = document.getElementById('recent-container');
            const list = document.getElementById('recent-list');
            if(history.length === 0) { container.style.display = 'none'; return; }
            container.style.display = 'block'; list.innerHTML = '';
            history.forEach(name => {
                const tag = document.createElement('div');
                tag.className = 'recent-tag';
                tag.innerHTML = `<img src="https://visage.surgeplay.com/face/32/${name}" class="recent-head">${name}`;
                tag.onclick = () => { document.getElementById('playerInput').value = name; fetchStats(); };
                list.appendChild(tag);
            });
        }
        
        function saveToHistory(name) {
            let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
            history = history.filter(n => n.toLowerCase() !== name.toLowerCase());
            history.unshift(name);
            if(history.length > 3) history.pop();
            localStorage.setItem('searchHistory', JSON.stringify(history));
            updateRecent();
        }
        
        function copyIP() {
            navigator.clipboard.writeText("play.slashup.net");
            const toast = document.getElementById("toast-box");
            toast.innerHTML = `<i class="fas fa-check-circle toast-icon"></i><div><div style="font-weight: bold; color: white;">IP Copied!</div><div style="font-size: 0.8rem; color: #aaa;">See you on the battlefield.</div></div>`;
            toast.classList.add("show");
            setTimeout(() => toast.classList.remove("show"), 3000);
        }
        
        async function checkServerStatus() {
            const ip = "194.164.96.27:25601"; 
            const statusText = document.getElementById('server-status-text');
            const statusDot = document.getElementById('status-dot');
            try {
                const res = await fetch(`https://api.mcstatus.io/v2/status/java/${ip}`);
                const data = await res.json();
                if(data.online) {
                    statusDot.classList.remove('offline'); statusDot.classList.add('online');
                    statusText.innerHTML = `<span class="status-dot online"></span> ${data.players.online}/${data.players.max} ONLINE`;
                } else {
                    statusText.innerHTML = `<span class="status-dot offline"></span> OFFLINE`;
                }
            } catch (e) { console.log("Status check failed"); }
        }

        document.querySelectorAll('.tilt-card').forEach(card => {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const rotateX = ((y - centerY) / centerY) * -10;
                const rotateY = ((x - centerX) / centerX) * 10;
                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
            });
            card.addEventListener('mouseleave', () => card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)');
        });

        // --- BACKGROUND ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvas.width; this.y = canvas.height + Math.random() * 100;
                this.size = Math.random() * 3 + 1; this.speedY = Math.random() * 1 + 0.5;
                this.opacity = Math.random() * 0.5 + 0.1;
            }
            update() { this.y -= this.speedY; this.opacity -= 0.002; if(this.opacity <= 0) this.reset(); }
            draw() { ctx.fillStyle = `rgba(255, 62, 62, ${this.opacity})`; ctx.fillRect(this.x, this.y, this.size, this.size); }
        }
        function initParticles() { for(let i=0; i<50; i++) particles.push(new Particle()); }
        function animateParticles() { ctx.clearRect(0,0,canvas.width,canvas.height); particles.forEach(p=>{p.update();p.draw();}); requestAnimationFrame(animateParticles); }

        // feed the global )':
        async function loadGlobalFeed() {
            const feed = document.getElementById('global-feed');
            if(!feed) return;
            try {
                const res = await fetch('/api/global_matches');
                const data = await res.json();
                feed.innerHTML = ''; 
                data.forEach((match, index) => {
                    const dateStr = new Date(match.match_time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    const card = `<div style="min-width: 280px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 1rem; display: flex; flex-direction: column; gap: 8px; opacity: 0; animation: lbSlideIn 0.5s forwards; animation-delay: ${index * 0.1}s;"><div style="font-size:0.7rem; color:#666; font-family:'Share Tech Mono'">${dateStr}</div><div style="display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 10px;"><div style="display:flex; align-items:center; gap:8px; overflow:hidden;"><img src="https://visage.surgeplay.com/face/32/${match.winner_name}" style="border-radius:4px; flex-shrink:0;"><span style="color:var(--win); font-weight:bold; font-size:0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${match.winner_name}</span></div><span style="font-size:0.7rem; color:#444; font-family:'Share Tech Mono';">VS</span><div style="display:flex; align-items:center; justify-content: flex-end; gap:8px; overflow:hidden;"><span style="color:#888; font-size:0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right;">${match.loser_name}</span><img src="https://visage.surgeplay.com/face/32/${match.loser_name}" style="border-radius:4px; filter:grayscale(100%); flex-shrink:0;"></div></div></div>`;
                    feed.innerHTML += card; 
                });
            } catch (e) { console.error("Pulse error:", e); }
        }

        window.addEventListener('scroll', reveal);
        function reveal() {
            var reveals = document.querySelectorAll('.reveal');
            for (var i = 0; i < reveals.length; i++) {
                var windowheight = window.innerHeight;
                var revealtop = reveals[i].getBoundingClientRect().top;
                if (revealtop < windowheight - 150) reveals[i].classList.add('active');
            }
        }
        reveal();


        //
        // end of script, pretty many lines dawg 
        //
    </script>
</body>
</html>
